<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title || 'è·å“¡ãƒšãƒ¼ã‚¸' %> - æ–½è¨­äºˆç´„ã‚·ã‚¹ãƒ†ãƒ ï¼ˆDEMOï¼‰</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif;
      line-height: 1.6;
      color: #333;
      background-color: #f5f5f5;
    }

    /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
    .header {
      background-color: #2c3e50;
      color: white;
      padding: 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      align-items: center;
      padding: 1rem 2rem;
    }

    .header h1 {
      font-size: 1.5rem;
      font-weight: 600;
    }

    .header-nav {
      display: flex;
      gap: 2rem;
      align-items: center;
      flex-wrap: wrap;
      justify-content: center;
    }

    .header-nav a {
      color: white;
      text-decoration: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      transition: background-color 0.2s;
    }

    .header-nav a:hover {
      background-color: rgba(255,255,255,0.1);
    }

    .header-user {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .user-profile-container {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.5rem 1rem;
      background-color: rgba(255,255,255,0.1);
      border-radius: 4px;
    }

    .user-profile-image {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid white;
    }

    .user-profile-default {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: rgba(255,255,255,0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      border: 2px solid white;
    }

    .user-profile-info {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }

    .user-profile-name {
      font-weight: 600;
      font-size: 0.95rem;
    }

    .user-profile-role {
      font-size: 0.8rem;
      opacity: 0.9;
    }

    /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
    .layout {
      display: flex;
      max-width: 1400px;
      margin: 0 auto;
      min-height: calc(100vh - 80px);
    }

    .sidebar {
      width: 250px;
      background-color: white;
      padding: 2rem 0;
      box-shadow: 2px 0 4px rgba(0,0,0,0.05);
    }

    .sidebar nav a {
      display: block;
      padding: 0.75rem 2rem;
      color: #333;
      text-decoration: none;
      transition: background-color 0.2s, color 0.2s;
      border-left: 3px solid transparent;
    }

    .sidebar nav a:hover,
    .sidebar nav a.active {
      background-color: #ecf0f1;
      color: #3498db;
      border-left-color: #3498db;
    }

    .sidebar-section {
      margin-bottom: 2rem;
    }

    .sidebar-section-title {
      padding: 0.5rem 2rem;
      font-size: 0.75rem;
      text-transform: uppercase;
      color: #7f8c8d;
      font-weight: 600;
      letter-spacing: 0.05em;
    }

    /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
    .main-content {
      flex: 1;
      padding: 2rem;
    }

    .page-header {
      margin-bottom: 2rem;
    }

    .page-title {
      font-size: 2rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .page-description {
      color: #7f8c8d;
    }

    /* ã‚«ãƒ¼ãƒ‰ */
    .card {
      background-color: white;
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .card-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 1rem;
    }

    /* ãƒœã‚¿ãƒ³ */
    .btn {
      display: inline-block;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 4px;
      font-size: 1rem;
      cursor: pointer;
      text-decoration: none;
      transition: background-color 0.2s;
    }

    .btn-primary {
      background-color: #3498db;
      color: white;
    }

    .btn-primary:hover {
      background-color: #2980b9;
    }

    .btn-success {
      background-color: #27ae60;
      color: white;
    }

    .btn-success:hover {
      background-color: #229954;
    }

    .btn-danger {
      background-color: #e74c3c;
      color: white;
    }

    .btn-danger:hover {
      background-color: #c0392b;
    }

    /* ãƒ†ãƒ¼ãƒ–ãƒ« */
    .table {
      width: 100%;
      border-collapse: collapse;
      background-color: white;
    }

    .table th,
    .table td {
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid #ecf0f1;
    }

    .table th {
      background-color: #f8f9fa;
      font-weight: 600;
      color: #2c3e50;
    }

    .table tr:hover {
      background-color: #f8f9fa;
    }

    /* ãƒãƒƒã‚¸ */
    .badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 12px;
      font-size: 0.875rem;
      font-weight: 500;
    }

    .badge-success {
      background-color: #d4edda;
      color: #155724;
    }

    .badge-warning {
      background-color: #fff3cd;
      color: #856404;
    }

    .badge-danger {
      background-color: #f8d7da;
      color: #721c24;
    }

    .badge-info {
      background-color: #d1ecf1;
      color: #0c5460;
    }

    /* ãƒ•ãƒƒã‚¿ãƒ¼ */
    .footer {
      background-color: #2c3e50;
      color: white;
      text-align: center;
      padding: 1.5rem;
      margin-top: 2rem;
    }

    /* ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰ãƒãƒŠãƒ¼ */
    .maintenance-banner {
      background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
      color: white;
      padding: 0.75rem 1rem;
      text-align: center;
      font-weight: 600;
      font-size: 0.95rem;
      box-shadow: 0 2px 6px rgba(231, 76, 60, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      position: relative;
      z-index: 1000;
    }

    .maintenance-banner-icon {
      font-size: 1.2rem;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.6;
      }
    }

    .maintenance-banner a {
      color: white;
      text-decoration: underline;
      margin-left: 1rem;
      font-weight: 700;
    }

    .maintenance-banner a:hover {
      color: #ecf0f1;
    }
  </style>
  <%- typeof additionalStyles !== 'undefined' ? additionalStyles : '' %>
</head>
<body>
  <!-- ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰è­¦å‘ŠãƒãƒŠãƒ¼ -->
  <% if (isMaintenanceMode) { %>
  <div class="maintenance-banner">
    <span class="maintenance-banner-icon">âš ï¸</span>
    <span>ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰ä¸­ã§ã™ï¼ä¸€èˆ¬åˆ©ç”¨è€…ã¯ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã€‚</span>
    <a href="/staff/settings">è¨­å®šç”»é¢ã§è§£é™¤ã™ã‚‹</a>
  </div>
  <% } %>

  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <header class="header">
    <div class="header-content">
      <h1><a href="/staff" style="color: inherit; text-decoration: none;">æ–½è¨­äºˆç´„ã‚·ã‚¹ãƒ†ãƒ ï¼ˆDEMOï¼‰ - è·å“¡ç®¡ç†ç”»é¢</a></h1>
      <nav class="header-nav">
        <div class="header-user">
          <% if (user) { %>
            <div class="user-profile-container">
              <div id="userProfileImageContainer">
                <div class="user-profile-default">ğŸ‘¤</div>
              </div>
              <div class="user-profile-info">
                <div class="user-profile-name" id="userProfileName">èª­ã¿è¾¼ã¿ä¸­...</div>
                <div class="user-profile-role"><%= user.role === 'admin' ? 'ç®¡ç†è€…' : 'è·å“¡' %></div>
              </div>
            </div>
            <a href="/staff/profile">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</a>
            <a href="#" onclick="return confirmLogout();">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
          <% } %>
        </div>
      </nav>
    </div>
  </header>

  <!-- ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ -->
  <div class="layout">
    <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
    <aside class="sidebar">
      <nav>
        <div class="sidebar-section">
          <div class="sidebar-section-title">ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼</div>
          <a href="/staff" class="<%= currentPath === '/staff' ? 'active' : '' %>">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
          <a href="/staff/reservations" class="<%= currentPath === '/staff/reservations' ? 'active' : '' %>">äºˆç´„ç®¡ç†</a>
          <a href="/staff/usages" class="<%= currentPath === '/staff/usages' ? 'active' : '' %>">åˆ©ç”¨è¨˜éŒ²ç®¡ç†</a>
          <a href="/staff/users" class="<%= currentPath === '/staff/users' ? 'active' : '' %>">åˆ©ç”¨è€…ç®¡ç†</a>
        </div>

        <div class="sidebar-section">
          <div class="sidebar-section-title">æ–½è¨­ç®¡ç†</div>
          <a href="/staff/facilities/rooms" class="<%= currentPath === '/staff/facilities/rooms' ? 'active' : '' %>">æ–½è¨­ç®¡ç†</a>
          <a href="/staff/facilities/equipment" class="<%= currentPath === '/staff/facilities/equipment' ? 'active' : '' %>">è¨­å‚™ç®¡ç†</a>
          <a href="/staff/facilities/closed-dates" class="<%= currentPath === '/staff/facilities/closed-dates' ? 'active' : '' %>">ä¼‘é¤¨æ—¥ç®¡ç†</a>
          <a href="/staff/holidays" class="<%= currentPath === '/staff/holidays' ? 'active' : '' %>">ç¥æ—¥ç®¡ç†</a>
        </div>

        <div class="sidebar-section">
          <div class="sidebar-section-title">ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³</div>
          <a href="/staff/announcements" class="<%= currentPath === '/staff/announcements' ? 'active' : '' %>">ãŠçŸ¥ã‚‰ã›ç®¡ç†</a>
          <a href="/staff/messages" class="<%= currentPath === '/staff/messages' ? 'active' : '' %>">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç®¡ç†</a>
        </div>

        <div class="sidebar-section">
          <div class="sidebar-section-title">è¿½åŠ æ©Ÿèƒ½</div>
          <a href="/staff/products" class="<%= currentPath === '/staff/products' ? 'active' : '' %>">ç‰©è²©ç®¡ç†</a>
          <a href="/staff/proxy-reservations" class="<%= currentPath === '/staff/proxy-reservations' ? 'active' : '' %>">ä»£è¡Œäºˆç´„</a>
          <a href="/staff/reports" class="<%= currentPath === '/staff/reports' ? 'active' : '' %>">ãƒ¬ãƒãƒ¼ãƒˆ</a>
        </div>

        <% if (user && user.role === 'admin') { %>
        <div class="sidebar-section">
          <div class="sidebar-section-title">ç®¡ç†è€…ãƒ¡ãƒ‹ãƒ¥ãƒ¼</div>
          <a href="/staff/management" class="<%= currentPath === '/staff/management' ? 'active' : '' %>">è·å“¡ç®¡ç†</a>
          <a href="/staff/settings" class="<%= currentPath === '/staff/settings' ? 'active' : '' %>">ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</a>
          <a href="/staff/activity-log" class="<%= currentPath === '/staff/activity-log' ? 'active' : '' %>">ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãƒ­ã‚°</a>
          <a href="/staff/user-activity-log" class="<%= currentPath === '/staff/user-activity-log' ? 'active' : '' %>">ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ã‚°</a>
        </div>
        <% } %>
      </nav>
    </aside>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <main class="main-content">
      <%- body %>
    </main>
  </div>

  <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
  <footer class="footer">
    <p>&copy; 2025 æ–½è¨­äºˆç´„ã‚·ã‚¹ãƒ†ãƒ ï¼ˆDEMOï¼‰. All rights reserved.</p>
  </footer>

  <!-- ã‚«ã‚¹ã‚¿ãƒ ãƒ€ã‚¤ã‚¢ãƒ­ã‚° -->
  <div id="customDialog" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 10000; align-items: center; justify-content: center;">
    <div id="customDialogBox" style="background-color: white; border-radius: 8px; padding: 2rem; max-width: 500px; width: 90%; box-shadow: 0 4px 20px rgba(0,0,0,0.3); transform: scale(0.9); transition: transform 0.2s ease-out;">
      <div id="customDialogIcon" style="text-align: center; font-size: 3rem; margin-bottom: 1rem;"></div>
      <h3 id="customDialogTitle" style="text-align: center; margin-bottom: 1rem; font-size: 1.25rem; color: #2c3e50;"></h3>
      <p id="customDialogMessage" style="text-align: center; margin-bottom: 2rem; color: #555; white-space: pre-wrap; line-height: 1.6;"></p>
      <div id="customDialogButtons" style="display: flex; gap: 1rem; justify-content: center;"></div>
    </div>
  </div>

  <script>
    // ã‚«ã‚¹ã‚¿ãƒ ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®è¡¨ç¤ºé–¢æ•°
    function showCustomDialog(type, message, title) {
      return new Promise((resolve) => {
        const dialog = document.getElementById('customDialog');
        const dialogBox = document.getElementById('customDialogBox');
        const iconEl = document.getElementById('customDialogIcon');
        const titleEl = document.getElementById('customDialogTitle');
        const messageEl = document.getElementById('customDialogMessage');
        const buttonsEl = document.getElementById('customDialogButtons');

        // ã‚¢ã‚¤ã‚³ãƒ³ã¨ã‚¿ã‚¤ãƒˆãƒ«ã‚’è¨­å®š
        if (type === 'confirm') {
          iconEl.innerHTML = 'â“';
          titleEl.textContent = title || 'ç¢ºèª';
        } else if (type === 'alert') {
          iconEl.innerHTML = 'â„¹ï¸';
          titleEl.textContent = title || 'ãŠçŸ¥ã‚‰ã›';
        } else if (type === 'error') {
          iconEl.innerHTML = 'âš ï¸';
          titleEl.textContent = title || 'ã‚¨ãƒ©ãƒ¼';
        } else if (type === 'success') {
          iconEl.innerHTML = 'âœ…';
          titleEl.textContent = title || 'æˆåŠŸ';
        }

        messageEl.textContent = message;

        // ãƒœã‚¿ãƒ³ã‚’ä½œæˆ
        buttonsEl.innerHTML = '';
        if (type === 'confirm') {
          const cancelBtn = document.createElement('button');
          cancelBtn.textContent = 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«';
          cancelBtn.className = 'btn';
          cancelBtn.style.cssText = 'background-color: #95a5a6; color: white; padding: 0.75rem 2rem; font-size: 1rem;';
          cancelBtn.onclick = () => {
            closeCustomDialog();
            resolve(false);
          };

          const okBtn = document.createElement('button');
          okBtn.textContent = type === 'confirm' && message.includes('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ') ? 'ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ' : 'OK';
          okBtn.className = 'btn';
          okBtn.style.cssText = type === 'confirm' && message.includes('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ') ?
            'padding: 0.75rem 2rem; font-size: 1rem; background-color: #e74c3c; color: white;' :
            'padding: 0.75rem 2rem; font-size: 1rem; background-color: #3498db; color: white;';
          okBtn.onclick = () => {
            closeCustomDialog();
            resolve(true);
          };

          buttonsEl.appendChild(cancelBtn);
          buttonsEl.appendChild(okBtn);
        } else {
          const okBtn = document.createElement('button');
          okBtn.textContent = 'OK';
          okBtn.className = 'btn btn-primary';
          okBtn.style.cssText = 'padding: 0.75rem 2rem; font-size: 1rem;';
          okBtn.onclick = () => {
            closeCustomDialog();
            resolve(true);
          };
          buttonsEl.appendChild(okBtn);
        }

        // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º
        dialog.style.display = 'flex';
        setTimeout(() => {
          dialogBox.style.transform = 'scale(1)';
        }, 10);

        // Escapeã‚­ãƒ¼ã§é–‰ã˜ã‚‹
        const handleEscape = (e) => {
          if (e.key === 'Escape') {
            closeCustomDialog();
            resolve(false);
            document.removeEventListener('keydown', handleEscape);
          }
        };
        document.addEventListener('keydown', handleEscape);

        // èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
        dialog.onclick = (e) => {
          if (e.target === dialog) {
            closeCustomDialog();
            resolve(false);
          }
        };
      });
    }

    function closeCustomDialog() {
      const dialog = document.getElementById('customDialog');
      const dialogBox = document.getElementById('customDialogBox');
      dialogBox.style.transform = 'scale(0.9)';
      setTimeout(() => {
        dialog.style.display = 'none';
      }, 200);
    }

    // ã‚°ãƒ­ãƒ¼ãƒãƒ«confirm/alerté–¢æ•°ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰
    window.confirm = function(message) {
      return showCustomDialog('confirm', message);
    };

    window.alert = function(message) {
      return showCustomDialog('alert', message);
    };

    // ã‚«ã‚¹ã‚¿ãƒ é–¢æ•°ã‚‚è¿½åŠ ï¼ˆå‘¼ã³å‡ºã—å´ã§awaitã§ãã‚‹ã‚ˆã†ã«ï¼‰
    window.showSuccess = function(message, title) {
      return showCustomDialog('success', message, title);
    };

    window.showError = function(message, title) {
      return showCustomDialog('error', message, title);
    };

    // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ã‚’èª­ã¿è¾¼ã¿
    async function loadUserProfile() {
      try {
        const response = await fetch('/api/staff/profile');
        if (!response.ok) return;

        const profile = await response.json();

        // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«åã‚’æ›´æ–° (ID:åå‰ ã¾ãŸã¯ ID:ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ )
        const displayName = profile.nickname || profile.name;
        const profileNameEl = document.getElementById('userProfileName');
        if (profileNameEl) {
          profileNameEl.textContent = `${profile.id}:${displayName}`;
        }

        // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã‚’æ›´æ–°
        const imageContainer = document.getElementById('userProfileImageContainer');
        if (imageContainer && profile.profileImagePath) {
          imageContainer.innerHTML = `<img src="/${profile.profileImagePath}" alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ" class="user-profile-image" onerror="this.parentElement.innerHTML='<div class=\\'user-profile-default\\'>ğŸ‘¤</div>'">`;
        }
      } catch (error) {
        console.error('Failed to load profile:', error);
        // ã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¡¨ç¤ºã®ã¾ã¾
      }
    }

    // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã¿
    <% if (user) { %>
    document.addEventListener('DOMContentLoaded', loadUserProfile);
    <% } %>

    // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆç¢ºèªé–¢æ•°
    async function confirmLogout() {
      const confirmed = await showCustomDialog('confirm', 'ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ', 'ãƒ­ã‚°ã‚¢ã‚¦ãƒˆç¢ºèª');
      if (confirmed) {
        window.location.href = '/logout';
      }
      return false;
    }
  </script>

  <%- typeof additionalScripts !== 'undefined' ? additionalScripts : '' %>
</body>
</html>
